<!doctype html>
<html lang="en">

   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Movie Demo</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet"
         integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
   </head>

   <body>
      <div id="menu"></div>
      <div class="container">
         <div class="row g-4 mt-4 p-4">
            <nav aria-label="Page navigation example">
               <ul class="pagination">
                  <li class="page-item"><button class="page-link" onclick="prev()">Previous</button></li>

                  <li class="page-item"><button class="page-link" onclick="next()">Next</button></li>
               </ul>
            </nav>
         </div>
         <div id="container-film" class="row g-4 mt-2 p-4">
            <div id="card-film" class="col-3 d-none">
               <div class="card h-100" style="width: 18rem;">
                  <img class="card-img-top" alt="...">
                  <div class="card-body">
                     <h5 class="card-title"></h5>
                     <p class="card-text"></p>

                  </div>
                  <div class="card-footer">
                     <p class="card-text">
                        <small class="text-body-secondary"></small>
                     </p>
                     <a href="#" class="btn btn-secondary">Scheda</a>
                  </div>
               </div>

            </div>
         </div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
      crossorigin="anonymous"></script>
      <script src="scripts/menu.js"></script>

      <script>

      function populateTracks(popolari) {
          var card = document.getElementById("card-film")
          var container = document.getElementById("container-film")
          container.innerHTML = ""
          container.append(card)

          for (var i = popolari.results.length - 1; i >= 0; i--) {
              var clone = card.cloneNode(true)

              clone.id = 'card-film-' + i
              clone.getElementsByClassName('card-title')[0].innerHTML = popolari.results[i].title
              clone.getElementsByClassName('card-text')[0].innerHTML = popolari.results[i].overview
              clone.getElementsByClassName('text-body-secondary')[0].innerHTML = popolari.results[i].release_date
              clone.getElementsByClassName('card-img-top')[0].src = image_base_url + popolari.results[i].poster_path
              clone.getElementsByClassName('btn')[0].href = "scheda-film.html?id_film=" + popolari.results[i].id

              clone.classList.remove('d-none')

              card.after(clone)

          }

      }

      /* This anonymous function is evalutated automatically */
      (function getTracks() {
         console.log("Calling getTracks");
         const query = document.getElementById('search_query');

         fetch(`http://localhost:3000/tracks/${query}`)
            .then(response => {
               if (!response.ok) {
                  response.json().then(data => alert(data.status_message))
                  return
               }
               response.json().then(data => populateTracks(data))
            })
            .catch(error => alert(error))
      })();

      </script>

   </body>

</html>

